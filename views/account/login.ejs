<div class="login-main" role="region" aria-label="Login form">
  <div class="login-container">
    <!-- Flash Messages Display -->
    <% if (messages && messages.error) { %>
      <div class="error-messages" role="alert">
        <% if (Array.isArray(messages.error)) { %>
          <% messages.error.forEach(msg => { %>
            <p class="error-text"><%= msg %></p>
          <% }); %>
        <% } else { %>
          <p class="error-text"><%= messages.error %></p>
        <% } %>
      </div>
    <% } %>

    <% if (messages && messages.success) { %>
      <div class="flash-message success" role="status">
        <%= messages.success %>
      </div>
    <% } %>

    <% if (messages && messages.notice) { %>
      <div class="notice-message" role="alert">
        <%= messages.notice %>
      </div>
   <% } %>

    <h1 class="login-title">Login</h1>

    <form id="loginForm" action="/account/login" method="POST" novalidate>
      <div class="form-group">
        <label for="account_email">Email:</label>
        <input 
          type="email" 
          id="account_email" 
          name="account_email" 
          required
          placeholder="example@domain.com"
          value="<%= typeof account_email !== 'undefined' ? account_email : '' %>"
          aria-describedby="email-help"
          class="<%= messages.error ? 'invalid' : '' %>"
        >
        <small id="email-help" class="form-help">Enter your registered email</small>
      </div>

      <div class="form-group">
        <label for="account_password">Password:</label>
        <div class="password-input-container">
          <input 
            type="password" 
            id="account_password" 
            name="account_password" 
            required
            minlength="12"
            aria-describedby="password-help"
            autocomplete="current-password"
            class="<%= messages.error ? 'invalid' : '' %>"
          >
          <button 
            type="button" 
            class="toggle-password" 
            aria-label="Toggle password visibility"
            aria-controls="account_password"
          >
            👁️
          </button>
        </div>
        <small id="password-help" class="form-help">Enter your password</small>
      </div>

      <div class="form-actions">
        <button type="submit" class="login-button">Login</button>
        <p class="register-link">
          Don't have an account? <a href="/account/register">Register here</a>.
        </p>
      </div>
    </form>
  </div>
</div>

<script>
  // Password visibility toggle
  document.querySelector('.toggle-password')?.addEventListener('click', function() {
    const passwordInput = document.getElementById('account_password');
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    this.textContent = type === 'password' ? '👁️' : '🔒';
    this.setAttribute('aria-label', 
      type === 'password' ? 'Show password' : 'Hide password');
  });

  // Add invalid class to fields with errors on page load
  document.addEventListener('DOMContentLoaded', function() {
    const errorExists = document.querySelector('.error-messages');
    if (errorExists) {
      document.querySelectorAll('input').forEach(input => {
        input.classList.add('invalid');
      });
    }
  });
</script>